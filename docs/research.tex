\chapter{Исследовательский раздел}

В данном разделе будет описана постановка эксперимента по сравнению времени выполнения запроса для получения данных о местоположении электросамокатов посредством реализованной базы данных с использованием и без использования индексации. Также будут приведены технические характеристики устройства, использованного во время исследования, представлены результаты измерений.

\section{Цель эксперимента}

Целью эксперимента является сравнение времени, требуемого для получения уникальных номеров электросамокатов, которые разрядились 25 мая 2023 года и в момент последней отправки информации о местоположении имели открытые замки, с и без использования индексации.

Для достижения этой цели требуется выполнить следующие действия.

\begin{enumerate}
    \item Сгенерировать список электросамокатов и массив записей об их местоположении.
    \item Заполнить соответствующие таблицы базы данных сгенерированными записями.
    \item Сформулировать SQL-запрос к базе данных, которой позволит извлечь необходимую информацию.
    \item Произвести замеры времени выполнения запроса до и после создания индекса, сравнить полученные результаты.
\end{enumerate}

\section{Описание эксперимента}

\DTLloaddb{benchmark}{./inc/data/benchmark.csv}

Для целей эксперимента было сгенерировано \num{90000} строк таблицы scooters, содержащих информацию об электросамокатах, а также \DTLrowcount{benchmark} наборов, содержащих по \DTLforeach*{benchmark}{\Count=count}{\DTLiflastrow{\num{\Count}}{\num{\Count}, }} строк таблицы pings с информацией о местоположении этих самокатов.

Для каждого набора сгенерированных записей из таблицы pings и всех записей из таблицы scooters были поочередно развернуты соответствующие базы данных. На каждой из этих баз данных был выполнен соответствующий цели эксперимента SQL-запрос (его исходный код приведен в приложении~\ref{appendix:research}). После того, как запрос завершился, а время его выполнения зафиксировано, был создан индекс (код создания приведен в приложении~\ref{appendix:research}). На той же базе данных, но с уже созданным индексом, запрос был выполнен снова.

Измерения времени проводились на стороне базы данных с использованием инструкции EXPLAIN ANALYZE. При этом учитывалось суммарное время планирования и выполнения запроса. В качестве итогового использовалось медианное значение времени по результатам \num{100} измерений.

\section{Технические характеристики устройства}

Исследование выполнялось на ноутбуке со следующими техническими характеристиками:

\begin{itemize}
    \item операционная система: macOS 12.2.1;
    \item объем оперативной памяти: 16 ГБ;
    \item процессор: Apple M1 Pro;
    \item количество ядер: 10.
\end{itemize}

Во время исследования устройство было подключено к сети питания и не нагружено дополнительными процессами.

\pagebreak
\section{Результаты эксперимента}

Полученные в результате эксперимента данные сведены в таблицу~\ref{tbl:benchmark}.

\begin{table}[H]
    \caption{Результаты эксперимента}
    \label{tbl:benchmark}
    {\renewcommand{\arraystretch}{1.2}
        \let\refstepcounter\stepcounter
        \begin{tabularx}{\textwidth}{
                | >{\hsize=.3\hsize\centering\arraybackslash}X
                | >{\hsize=.25\hsize\centering\arraybackslash}X
                | >{\hsize=.25\hsize\centering\arraybackslash}X
                | >{\hsize=.2\hsize\centering\arraybackslash}X |
            }
            \hline
            \multirow{2}{.3\linewidth}{\centering Количество строк таблицы pings} & \multicolumn{2}{c|}{Время выполнения запроса, мс} & \multirow{2}*{Ускорение}                                                                     \\   \cline{2-3}
                                                                                  & {Без индексации}                                  & С индексацией                       &
            \DTLforeach*{benchmark}{\Count=count,\TimeNoIndex=ms_noindex,\TimeIndex=ms_index,\Profit=profit}{
            \\ \hline
            \num[round-precision=0]{\Count}                                       & \num[round-precision=3]{\TimeNoIndex}             & \num[round-precision=3]{\TimeIndex} & ${\scriptstyle\times}$\num[round-precision=0]{\Profit}
            }
            \\\hline
        \end{tabularx}   }
\end{table}

\pagebreak
Результаты эксперимента в графическом виде изображены на рисунке~\ref{img:benchmark}.

\includeimage
{benchmark}
{f}
{H}
{\textwidth}
{Результаты эксперимента}

\section*{Вывод}

\def\MaxProfit{0}
\DTLforeach*{benchmark}{\Profit=profit}{\DTLmax{\MaxProfit}{\MaxProfit}{\Profit}}

На основании данных, полученных в результате эксперимента, можно сделать следующие выводы.

\begin{enumerate}
    \item При небольших размерах таблицы (от 1 до 250 строк) использование индексов не оправдано: при количестве строк 125 и 250 разница во времени выполнения запроса с индексом и без несущественна.
    \item При увеличении количества строк в таблице разница во времени начинает увеличиваться: запросы, использующие индекс, могут выполняться до \num[round-precision=0, round-mode=places]{\MaxProfit} раз быстрее.
    \item При увеличении количества строк в таблице время выполнения запросов, использующих индекс, практически не увеличивается. Запросы, не использующие индекс, напротив, с каждым шагом увеличения количества строк начинают выполнятся как минимум в 2 раза дольше --- можно говорить о линейной зависимости времени выполнения от количества строк таблицы.
\end{enumerate}

Таким образом, индексы баз данных являются полезным инструментом для повышения производительности запросов. Они позволяют быстро находить и извлекать данные, ускоряя выполнение операций чтения и поиска. Индексы также помогают уменьшить нагрузку на базу данных, что может привести к улучшению ее производительности в целом. Без индексов поиск данных может занимать значительное время, особенно при работе с большими объемами данных. Поэтому использование индексов необходимо для эффективной работы с базами данных.

Можно также сказать, что запрос, оптимально использующий индексацию, не станет \enquote{бутылочным горлышком} кикшеринг-сервиса при увеличении объема клиентов и парка электросамокатов.