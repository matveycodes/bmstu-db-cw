\chapter{Аналитический раздел}

В данном разделе будут выдвинуты требования к приложению, определены пользователи системы, формализованы хранимые сервисом данные. Также будет проведен анализ существующих решений и выбрана модель базы данных.

\section{Анализ предметной области}

Предметной областью поставленной задачи является операционная деятельность сервиса краткосрочной аренды электросамокатов в крупном городе. 

Пользователями кикшеринга являются лица, достигшие возраста 18 лет. Для регистрации необходим адрес электронной почты, номер телефона, а также реквизиты банковской карты~\cite{whoosh-reqs}.

Для поиска доступных для аренды электросамокатов пользователи используют специально разработанное мобильное приложение, где на карте отмечены парковки и свободные самокаты. В этом же приложении пользователи кикшеринг-сервиса выбирают нужный им самокат и или бронируют его, или начинают на нём аренду.

Бронирование позволяет скрыть электросамокат с карты для других пользователей на определенное время. В большинстве кикшеринг-сервисов бронирование бесплатно и предусматривает отмену без необходимости начинать аренду. При этом некоторые сервисы могут требовать от пользователя находиться недалеко от бронируемого самоката.

Для начала аренды пользователи сканируют QR-код на руле электросамоката или вводят его номер.

Стоимость аренды зачастую складывается из двух составляющих: платы за старт и платы за каждую минуту поездки. В зависимости от спроса на самокаты на конкретной парковке цены могут быть скорректированы в б\'{о}льшую сторону. Перед началом аренды на банковской карте пользователя блокируется определенная сумма, которая возвращается после завершения поездки. По желанию пользователя и за дополнительную плату поездка может быть застрахована. 

Во время поездки пользователю доступна информация о километраже, длительности и стоимости аренды. При попадании в зону с ограничением максимальной скорости движения электросамокат автоматически сбрасывает скорость и не позволяет превысить установленный лимит до выезда из зоны.

Пользователи также имеют возможность поставить аренду на паузу и заблокировать самокат. При этом во время простоя плата за аренду продолжает начисляться.

Завершение аренды возможно на специальных парковках, отмеченных на карте в мобильном приложении. По завершении аренды у пользователя может быть запрошена фотография припаркованного самоката.

Для решения вопросов и проблем при использовании сервиса пользователи могут обратиться к сотрудникам клиентской поддержки в чате в приложении.

Для автоматизации учета информации о пользователях, поездках, самокатах, тарифах и т.д. разрабатывается специализированная информационная система. Использование данной системы возможно пользователями с различными уровнями доступа.

\section{Анализ существующих решений}

Для проведения анализа существующих решений среди имеющихся на рынке сервисов кикшеринга были выбраны три наиболее популярных~\cite{hype}: Whoosh~\cite{whoosh}, Юрент~\cite{urent} и Яндекс Go~\cite{yago}. Сравнение проводилось по следующим критериям.

\begin{enumerate}
    \item Количество одновременных аренд разных самокатов, которое может начать пользователь с одного аккаунта.
    \item Возможность забронировать электросамокат, находясь на любом расстоянии до него.
    \item Необходимость делать фотографии припаркованного самоката после завершения поездки.
    \item Возможность поставить аренду на паузу по более низкой цене в минуту, чем во время активной аренды.
    \item Возможность посмотреть суммарный километраж всех поездок.
\end{enumerate}

Результат сравнения представлен в таблице \ref{tbl:comparison}.

\begin{table}[H]
    \caption{Анализ существующих решений}
    \label{tbl:comparison}
    {\renewcommand{\arraystretch}{1.2}
    \begin{tabularx}{\textwidth} 
        {
            | >{\raggedright\arraybackslash}X 
            | >{\centering\arraybackslash}X 
            | >{\centering\arraybackslash}X 
            | >{\centering\arraybackslash}X |
        }
        \hline
        \textbf{Критерий} & \textbf{Whoosh} & \textbf{Юрент} & \textbf{Яндекс Go}\\
        \hline
        Количество одновременных аренд & не более 3 & не более 5 & не более 3\\
        \hline
        Бронирование с любого расстояния & $+$ & $-$ & $-$\\
        \hline
        Фотография после поездки & $-$ & $+$ & $+$\\
        \hline
        Пауза по сниженной цене & $-$ & $-$ & $+$\\
        \hline
        Суммарный километраж & $+$ & $-$ & $-$\\
        \hline
    \end{tabularx}}
\end{table}

Создаваемый в рамках курсовой работы сервис должен не просто быть на уровне с конкурентами, но и предоставлять пользователям дополнительный функционал. Конкурентными преимуществами станут:

\begin{itemize}
    \item возможность взять в аренду до 10 самокатов одновременно;
    \item возможность бронировать самокат с любого расстояния;
    \item отсутствие необходимости делать фотографию после завершения аренды.
\end{itemize}

\section{Требования к разрабатываемой базе данных и приложению}

Предметная область поставленной задачи является обширной и включает в себя множество понятий и связей между ними, в связи с этим были сформулированы следующие требования к разрабатываемой программе в рамках курсовой работы.

\begin{enumerate}
    \item Должен быть предоставлен функционал для регистрации и аутентификации пользователей в системе, также должен быть создан личный кабинет с основной информацией о пользователе.
    \item Должен быть предоставлен функционал для получения списка парковок и доступных для аренды электросамокатов.
    \item Должен быть предоставлен функционал для начала и завершения аренды.
    \item Должен быть предоставлен функционал для ограничения скорости электросамокатов в определенных зонах города.
    \item Должен быть предоставлен функционал для бронирования электросамокатов.
    \item Должен быть предоставлен функционал для сохранения истории поездок с возможностью просмотра пользователем своих поездок.
    \item Должен быть предоставлен функционал для взаимодействия с клиентской поддержкой.
    \item Должен быть предоставлен функционал для хранения истории перемещений электросамокатов.
\end{enumerate}

Также были сформулированы следующие допущения:

\begin{enumerate}
    \item Оплата поездок производится сторонним платежным сервисом, предоставляющем программный интерфейс для взаимодействия (API). Реализация подобного функционала выходит за рамки курсовой работы по базам данных.
    \item Верификация номера телефона пользователя, равно как и отправка на него СМС-сообщений реализуется сторонним сервисом, предоставляющим программный интерфейс для взаимодействия (API). Реализация подобного функционала выходит за рамки курсовой работы по базам данных.
\end{enumerate}

\section{Формализация данных}

На~рисунке~\ref{img:er} представлена ER-диаграмма сущностей проектируемой базы данных в нотации Чена, описывающая объекты предметной области и их взаимодействие.

\includeimage
    {er}
    {f}
    {H}
    {\textwidth}
    {ER-диаграмма сущностей проектируемой базы данных}

Информационная система, проектируемая в ходе выполнения курсовой работы, включает в себя информацию о следующих объектах.

\begin{enumerate}
    \item Аккаунт --- сущность общего вида, описывающая каждый из четырех возможных подтипов сущностей-пользователей в системе: администратор, сотрудник клиентской поддержки, механик и пользователь. Сущность пользователя дополнительно хранит дату рождения для верификации возраста.
    \item Парковка --- сущность, описывающая городскую велопарковку или любое другое место, где можно оставить самокат.
    \item Зона ограничения скорости --- сущность, описывающая часть города, где максимальная скорость движения ограничена некоторым значением из соображений безопасности.
    \item Электросамокат --- сущность, хранящая информацию о самокате, который пользователи могут брать в аренду. Как IoT-устройство~\cite{iot} самокат может отправлять информацию о себе в систему, создавая записи в истории перемещений. Во время аренды электросамокат может попадать в несколько зон ограничения скорости. Для завершения аренды самокат должен быть оставлен на одной из доступных парковок.
    \item Бронирование --- сущность, описывающая процесс резервирования пользователем конкретного самоката на определенный промежуток времени.
    \item Аренда --- сущность, описывающая процесс проката пользователем электросамоката с фиксированным на момент старта поездки тарифом.
    \item Настройка --- сущность, хранящая соответствие имени переменной и некоторого значения (например, стоимости страховки).
    \item Токен авторизации --- сущность, которая используется для авторизации запросов от пользователя к серверу для исключения передачи пароля.
\end{enumerate}

\section{Формализация пользователей приложения}

Ролевая модель используется для реализации системы безопасности сервера базы данных и позволяет разрешать или запрещать тем или иным группам пользователей работу с объектами базы данных.

В рамках поставленной задачи выделены следующие роли.

\begin{enumerate}
    \item Администратор. Имеет максимальный уровень доступа ко всем данным сервиса.
    \item Сотрудник клиентской поддержки. Имеет доступ к информации о пользователях и их поездках.
    \item Механик. Имеет доступ к информации о самокатах, которые требуют обслуживания (например, замены аккумулятора).
    \item Пользователь. Имеет возможность брать самокаты в аренду, просматривать историю поездок, связываться с клиентской поддержкой.
    \item Электросамокат. Имеет возможность создавать записи в истории перемещений.
\end{enumerate}

\section{Диаграмма вариантов использования}

На рисунках~\ref{img:unauth-use-case}--\ref{img:admin-use-case} представлены диаграммы вариантов использования системы в соответствии с выделенными типами пользователей.

\includeimage
    {unauth-use-case}
    {f}
    {H}
    {.75\textwidth}
    {Диаграмма вариантов использования системы неавторизованным пользователем}

\includeimage
    {auth-use-case}
    {f}
    {H}
    {.75\textwidth}
    {Диаграмма вариантов использования системы авторизованным пользователем}

\includeimage
    {cc-use-case}
    {f}
    {H}
    {\textwidth}
    {Диаграмма вариантов использования системы сотрудником клиентской поддержки}

\includeimage
    {technician-use-case}
    {f}
    {H}
    {.5\textwidth}
    {Диаграмма вариантов использования системы механиком}

\includeimage
    {admin-use-case}
    {f}
    {H}
    {\textwidth}
    {Диаграмма вариантов использования системы администратором}

\includeimage
    {scooter-use-case}
    {f}
    {H}
    {.5\textwidth}
    {Диаграмма вариантов использования системы электросамокатом}

\section{Анализ существующих баз данных}

По организации и способу хранения данных все базы данных можно разделить на две группы: реляционные и нереляционные. Реляционные базы данных в свою очередь делятся на строковые и колоночные, а нереляционные --- на графовые, документные и базы данных типа <<ключ-значение>>.

\subsection{Реляционные базы данных}

Реляционные базы данных основываются на реляционной модели данных. Данные в таких базах организованы в виде набора таблиц, состоящих из столбцов и строк. В таблицах хранится информация об объектах, представленных в базе данных. Такие базы данных удобно использовать для хорошо структурированных данных.

\subsubsection{Строковые базы данных}

Строковыми базами данных называются базы данных, записи которых в памяти представлены построчно. Строковые базы данных используются в транзакционных системах. Для таких систем характерно большое количество коротких транзакций с операциями вставки, обновления и удаления данных.

\subsubsection{Колоночные базы данных}

Колоночными базами данных называются базы данных, записи которых в памяти представляются по столбцам. Колоночные базы данных используются в аналитических системах. Такие системы характеризуются низким объемом транзакций, а запросы к ним зачастую сложны и включают в себя агрегацию.

\subsection{Нереляционные базы данных}

Нереляционная база данных --- это база данных, в которой в отличие от большинства традиционных систем баз данных не используется табличная схема строк и столбцов. В этих базах данных применяется модель хранения, оптимизированная под конкретные требования типа хранимых данных.

\subsubsection{Базы данных <<ключ-значение>>}

В базах данных <<ключ-значение>> данные хранятся как совокупность пар ключ-значение, где ключ служит уникальным идентификатором. Такие базы данных удобно использовать для хранения и обработки разных по типу и содержанию данных, их легко масштабировать. Однако такой тип баз данных не подходит для работы со сложными и связанными друг с другом данными.

\subsubsection{Документные базы данных}

Документные базы данных --- это тип нереляционных баз данных, предназначенный для хранения и запроса данных в виде документов в формате, подобном JSON. Такие базы данных позволяют хранить и запрашивать данные в базе данных с помощью той же документной модели, которая используются в коде приложения. Документные базы данных хорошо подходят для быстрой разработки систем и сервисов, работающих с по-разному структурированными данными. Они легко масштабируются и меняют структуру при необходимости. Однако такие базы данных теряют свою эффективность при решении задач, в которых требуется работа с множеством связанных объектов.

\subsubsection{Графовые базы данных}

Графовые базы данных --- это тип нереляционных баз данных, предназначенный для хранения взаимосвязей между сущностями и навигации по ним. Для хранения сущностей используются узлы, а для хранения их взаимосвязей --- ребра. В таких базах отсутствуют ограничения на количество и тип взаимосвязей, которые может иметь узел. Графовые базы данных используются для решении задач, имеющих сложные взаимосвязи между данными. При незначительном количестве связей и больших объемах данных графовые базы данных демонстрируют значительно более низкую производительность.

Для решения поставленной задачи была выбрана реляционная база данных с построчным хранением данных, так как:

\begin{itemize}
    \item задача предполагает хранение структурированных и связанных данных;
    \item задача предполагает постоянное добавление и изменение данных;
    \item задача предполагает быструю отзывчивость на запросы пользователя;
    \item задача не предполагает выполнения сложных аналитических запросов.
\end{itemize}

\section*{Вывод}

В данном разделе были выделены ролевые модели системы, конкретизированы хранимые данные и их связь между собой, построены соответствующие диаграммы. Также был проведен анализ существующих на рынке решений, который позволил понять, какие особенности стоит добавить в разрабатываемый проект. Был осуществлен выбор модели базы данных.