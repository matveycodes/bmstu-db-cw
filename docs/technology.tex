\chapter{Технологический раздел}

В данном разделе будет выбрана система управления базой данных (СУБД), описаны средства реализации приложения, создание базы данных, триггера, ролей с последующим выделением прав, наполнение базы, также будет спроектирован графический пользовательский интерфейс.

\section{Выбор средств реализации}

В настоящее время существует множество систем управления базами данных, работающих по реляционной модели. Среди самых распространенных~[\ref{dmbs}] выделяют Oracle, MySQL, Microsoft SQL Server и PostgreSQL. В качестве системы управления базами данных была выбрана PostgreSQL~[\ref{postgres}], так как данная СУБД является свободным программным обеспечением (OSS) и предоставляется бесплатно.

В качестве языка программирования для написания серверной части был выбран TypeScript, поскольку он имеет все необходимые возможности для решения поставленной задачи и, в отличие от JavaScript, строгую типизацию. Для данного языка также разработано множество библиотек, в том числе для взаимодействия с базами данных.

В ходе решения поставленной задачи были использованы дополнительные инструменты, расширяющие базовый функционал языка TypeScript: koa~[\ref{koa}] --- для маршрутизации, обработки входящих и исходящих запросов, pg-promise~[\ref{pg-promise}] и sqlstring~[\ref{sqlstring}] --- для взаимодействия с базой данных.

Графический пользовательский интерфейс (GUI) представляет собой реактивное одностраничное веб-приложение (SPA), написанное на TypeScript и React~[\ref{react}] при помощи библиотеки компонентов Chakra UI~[\ref{chakra}].

Для одновременного запуска всех компонентов сервиса используется Docker~[\ref{docker}] и система управления развертыванием Docker Compose. Это позволяет разворачивать сервис на разных операционных системах без внесения изменений в исходный код.

\pagebreak
\section{Архитектура сервиса}

Разрабатываемый в рамках курсовой работы сервис состоит из следующих взаимосвязанных компонентов:

\begin{itemize}
    \item клиентская часть (фронтенд);
    \item серверная часть (бэкенд);
    \item база данных.
\end{itemize}

Клиентская часть обменивается данными с серверной посредством REST API~[\ref{rest}]. Данные передаются в текстовом формате JSON, так как и фронтенд, и бэкенд написаны на диалекте JavaScript, для которого JSON является нативным способом представления структурированных данных.

Серверная часть сервиса взаимодействует с базой данных посредством коннекторов, позволяющих выполнять запросы к базе данных на языке программирования, используемом для разработки приложения.

\section{Методы тестирования}

При тестировании серверной части сервиса использовались как модульные, так и интеграционные тесты. Для их реализации была использована специализированная библиотека jest~[\ref{jest}]. Общее количество интеграционных тестов составило 55, интеграционных --- 39.

Тестирование клиентской части производилось вручную.

\section{Создание и наполнение таблиц базы данных}

Скрипт создания таблиц базы данных приведен в приложении~\ref{appendix:init}.

Некоторые таблицы базы данных были предварительно заполнены данными, похожими на реальные. Их краткое содержание представлено в приложении~\ref{appendix:sample-data}. Это упростило тестирование и позволит облегчить демонстрацию работы сервиса.

Данные для таблицы parkings со списком парковок города Москвы были взяты из OpenStreetMap~[\ref{osm}] --- открытого проекта картографических данных. Итоговое количество парковок --- 2371.

Таблицы настроек settings и подписок subscriptions были заполнены данными, полученными из опыта взаимодействия с аналогичными кикшеринг-сервисами, в частности Whoosh и Юрент.

Зоны ограничения скорости для таблицы restricted\_zones были размечены вручную.

Список электросамокатов, хранящийся в таблице scooters, был сгенерирован случайным образом с ограничением на уникальность номера и имеет длину в 2000 записей.

Для каждого электросамоката из таблицы scooters была сгенерирована одна запись в истории перемещений со случайными параметрами. Местоположение самоката было подобрано таким образом, чтобы он оказался на одной из парковок.

\section{Реализация ролевой модели}

В соответствии с описанной в аналитическом и конструкторском разделах ролевой моделью были созданы следующие роли пользователей базы данных:

\begin{itemize}
    \item guest --- гость;
    \item pending\_customer --- клиент, не подтвердивший свой возраст;
    \item customer --- активный клиент;
    \item technician --- механик;
    \item scooter --- электросамокат;
    \item admin --- администратор.
\end{itemize}

Имя пользователя базы данных должно иметь формат u\_<UUID без дефисов>, где <UUID без дефисов> --- это значение поля id соответствующей записи в таблице users, из которого были удалены дефисы.

Скрипт создания ролей на уровне базы данных приведен в приложении~\ref{appendix:roles}.

\section{Реализация триггера}

В соответствии со схемой алгоритма, представленной на рисунке~\ref{img:trigger}, был разработан соответствующий триггер. Его код приведен в приложении~\ref{appendix:trigger}.

\section{Интерфейс доступа к базе данных}

Для доступа к базе данных было разработано SPA --- одностраничное веб-приложение.

На рисунке~\ref{img:guest} представлен внешний вид приложения для неавторизованного пользователя (гостя), который имеет возможность посмотреть на карте парковки (отмечены иконками \enquote{P}) и зоны ограничения скорости (изображены как полупрозрачные многоугольники), а также авторизоваться или зарегистрироваться, нажав на кнопку \enquote{Войти}.

\includeimage
{guest}
{f}
{H}
{\textwidth}
{Внешний вид веб-приложения для неавторизованного пользователя}

На рисунке~\ref{img:active} изображен внешний вид приложения для активного клиента. На карте отмечены самокаты, доступные для аренды. Для удобства восприятия и повышения производительности множество самокатов в одном месте кластеризуется в виде окружности с числом, соответствующим количеству самокатов в кластере. В левой части экрана клиент может отслеживать активные бронирования и поездки, управлять самокатом и ходом аренды, запрашивать историю поездок и список доступных к покупке подписок (рисунок~\ref{img:subscriptions}).

\includeimage
{active}
{f}
{H}
{\textwidth}
{Внешний вид веб-приложения для активного клиента}

\includeimage
{subscriptions}
{f}
{H}
{\textwidth}
{Доступные подписки}

На рисунке~\ref{img:active-history} изображен список поездок клиента, который тот может запросить в приложении, нажав на кнопку \enquote{История поездок}. Список отсортирован: ранние поездки будут в конце списка, последние --- в начале.

\includeimage
{active-history}
{f}
{H}
{\textwidth}
{История поездок}

На рисунке~\ref{img:technician} изображен внешний вид приложения для механика. На карте отмечены самокаты, требующие обслуживания (замены или зарядки батареи).

\includeimage
{technician}
{f}
{H}
{\textwidth}
{Внешний вид веб-приложения для механика}

На рисунке~\ref{img:admin} изображен внешний вид приложения для администратора. В левой части экрана представлены значения действующих на текущий момент настроек сервиса. Также есть возможность посмотреть список всех пользователей (рисунок~\ref{img:admin-users}) и при необходимости заблокировать некоторых из них.

\includeimage
{admin}
{f}
{H}
{\textwidth}
{Внешний вид веб-приложения для администратора}

\includeimage
{admin-users}
{f}
{H}
{\textwidth}
{Список пользователей, доступный администратору сервиса}

\section*{Вывод}

В данном разделе была выбрана СУБД, описаны средства реализации приложения, создание базы данных, триггера, ролей с последующим выделением прав, наполнение базы, а также спроектирован пользовательский интерфейс.